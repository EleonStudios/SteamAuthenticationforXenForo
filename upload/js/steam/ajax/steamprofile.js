/* Oct 23, 2014 at 10:24 AM */

function SteamProfile(){function t(b){return a+d+"?steamids="+b}function u(a){return j.find('vars > var[name="'+a+'"]').text()}function v(a){return"true"==u(a).toLowerCase()}function w(){l=v("slidermenu"),k=v("gamebanner"),m=v("tf2items"),e=u("language"),f=e,null==g[f]&&(f="english"),p=$(j.find("templates > profile").text()),q=$(jQuery.parseHTML(j.find("templates > loading").text())),r=$(jQuery.parseHTML(j.find("templates > error").text())),p.find(".sp-joingame").attr("title",g[f].join_game),p.find(".sp-addfriend").attr("title",g[f].add_friend),p.find(".sp-viewitems").attr("title",g[f].view_tf2items),q.append(g[f].loading),i=!0,SteamProfile.refresh()}function x(){for(var a=999,b=[],c=0,d="",e=$(n).length,f=0;f<$(n).length;f++){var g=!1;if("undefined"==typeof o[$(n[f]).data("profileID")])c>0&&(d+=","),d+=$(n[f]).data("profileID"),b[$(n[f]).data("profileID")]=!0,g=!0,c++,(c==a||c==e)&&(setTimeout(function(){jQuery.ajax({global:!1,type:"GET",url:t(d),dataType:"json",cache:!0,success:function(a){a&&($(a.response.players).each(function(){var b=$(this)[0].steamid;o[b]=y($(this));for(var c=0;c<$(n).length;c++)$(n[c]).data("profileID")==b&&$(n[c]).html(o[b].html())}),z())}})},10),c=0);else for(var i=0;i<$(n).length;i++)$(n[i]).data("profileID")==steamID&&$(n[i]).append(o[steamID])}h=!1}function y(a){a=a[0];{var b=p.clone();a.profilestate}if(b.find(".sp-avatar img").attr("src",a.avatar),b.find(".sp-info a").append(a.personaname),3!=a.communityvisibilitystate)b.find(".sp-info").append("<div>"+g[f].private_profile+"</div>"),b.find(".sp-badge").addClass("sp-"+g[f].profile_visibilities[0]);else if("undefined"!=typeof a.gameid)b.find(".sp-info").append(g[f].profile_visibilities[5]),b.find(".sp-info").append("<br>"+a.gameextrainfo),b.find(".sp-badge").addClass("sp-"+g[f].profile_visibilities[5]);else switch(b.find(".sp-info").append("<div>"+g[f].profile_visibilities[a.personastate]+"</div>"),a.personastate){case 0:b.find(".sp-badge").addClass("sp-"+g[f].profile_visibilities[0]);break;default:b.find(".sp-badge").addClass("sp-"+g[f].profile_visibilities[1])}return k&&"undefined"!=typeof a.gameLogoSmall?b.find(".sp-bg-game-img").css("background-image","url("+a.gameLogoSmall+")"):(b.removeClass("sp-bg-game-img"),b.find(".sp-bg-fade").attr("class","sp-bg-no-fade")),l?("undefined"!=typeof a.gameserverip?b.find(".sp-joingame").attr("href","steam://connect/"+a.gameserverip):b.find(".sp-joingame").remove(),b.find(".sp-addfriend").attr("href","steam://friends/add/"+a.steamid),b.find(".sp-addfriend").attr("title",g[f].add_friend),b.find(".sp-viewgames").attr("href","http://steamcommunity.com/profiles/"+a.steamid+"/games/"),b.find(".sp-viewgames").attr("title",g[f].view_games),b.find(".sp-viewfriends").attr("href","http://steamcommunity.com/profiles/"+a.steamid+"/friends/"),b.find(".sp-viewfriends").attr("title",g[f].view_friends),b.find(".sp-viewgroups").attr("href","http://steamcommunity.com/profiles/"+a.steamid+"/groups/"),b.find(".sp-viewgroups").attr("title",g[f].view_groups),b.find(".sp-viewinventory").attr("href","http://steamcommunity.com/profiles/"+a.steamid+"/inventory/"),b.find(".sp-viewinventory").attr("title",g[f].view_inventory),b.find(".sp-viewwishlist").attr("href","http://steamcommunity.com/profiles/"+a.steamid+"/wishlist/"),b.find(".sp-viewwishlist").attr("title",g[f].view_wishlist),b.find(".sp-viewvideos").attr("href","http://steamcommunity.com/profiles/"+a.steamid+"/videos/"),b.find(".sp-viewvideos").attr("title",g[f].view_videos),b.find(".sp-viewscreenshots").attr("href","http://steamcommunity.com/profiles/"+a.steamid+"/screenshots/"),b.find(".sp-viewscreenshots").attr("title",g[f].view_screenshots)):b.find(".sp-extra").remove(),b.find(".sp-avatar a, .sp-info a").attr("href","http://steamcommunity.com/profiles/"+a.steamid),b}function z(){$(".sp-handle").unbind("click").click(function(a){$(this).siblings(".sp-content").animate({width:"toggle"},200,"linear"),a.stopPropagation()})}var j,k,l,m,p,q,r,a="js/steam/",c="ajax/steamprofile.xml",d="jsonproxy.php",e="english",f="english",g={english:{loading:"Loading...",no_profile:"This user has not yet set up their Steam Community profile.",private_profile:"This profile is private.",invalid_data:"Invalid profile data.",join_game:"Join Game",add_friend:"Add to Friends",view_tf2items:"View TF2 Backpack",view_games:"View games",view_friends:"View friends",view_groups:"View groups",view_inventory:"View inventory",view_wishlist:"View wishlist",view_videos:"View videos",view_screenshots:"View screenshots",profile_visibilities:{0:"Offline",1:"Online",2:"Busy",3:"Away",4:"Snooze",5:"In-Game",7:"Looking to Trade",6:"Looking to Play"}},german:{loading:"Lade...",no_profile:"Dieser Benutzer hat bisher kein Steam Community Profil angelegt.",private_profile:"Dieses Profil ist privat.",invalid_data:"Ung\xfcltige Profildaten.",join_game:"Spiel beitreten",add_friend:"Als Freund hinzuf\xfcgen",view_tf2items:"TF2-Items ansehen",view_games:"View games",view_friends:"View friends",view_groups:"View groups",view_inventory:"View inventory",view_wishlist:"View wishlist",view_videos:"View videos",view_screenshots:"View screenshots",profile_visibilities:{0:"Offline",1:"Online",2:"Besch\xe4ftigt",3:"Abwesend",4:"Unt\xe4tig",5:"Im Spiel",7:"M\xf6chte handeln",6:"M\xf6chte spielen"}},portuguese:{loading:"Carregando...",no_profile:"This user has not yet set up their Steam Community profile.",private_profile:"This profile is private.",invalid_data:"Invalid profile data.",join_game:"Entrar",add_friend:"Adicionar \xe0 sua lista de amigos",view_tf2items:"Ver Itens do TF2",view_games:"View games",view_friends:"View friends",view_groups:"View groups",view_inventory:"View inventory",view_wishlist:"View wishlist",view_videos:"View videos",view_screenshots:"View screenshots",profile_visibilities:{0:"Offline",1:"Online",2:"Busy",3:"Away",4:"Snooze",5:"In-Game",7:"Looking to Trade",6:"Looking to Play"}}},h=!1,i=!1,n=[],o={};this.init=function(){jQuery.ajax({type:"GET",global:!1,url:a+c,dataType:"xml",success:function(a){j=$(a),w()}})},this.refresh=function(){i&&!h&&(h=!0,n=$(".steamprofile[title]"),0!==n.length&&(n.each(function(){var a=$(this);a.data("profileID",$.trim(a.attr("title"))),a.removeAttr("title")}),n.empty().append(q),x()))},this.load=function(a){return i&&!h?(profile=$('<div class="steamprofile"></div>'),profile.append(q),jQuery.ajax({type:"GET",global:!1,url:t(a),dataType:"json",success:function(a){var c=a.response.players;profile.empty().append(y(c))}}),profile):void 0},this.isLocked=function(){return h}}$(document).ready(function(){SteamProfile=new SteamProfile,SteamProfile.init()});